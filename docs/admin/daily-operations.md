# 日常運用ガイド

> 定期作業・監視・メンテナンスの実施ガイド

## 📋 目次
1. [日常作業チェックリスト](#日常作業チェックリスト)
2. [毎日の作業](#毎日の作業)
3. [毎週の作業](#毎週の作業)
4. [毎月の作業](#毎月の作業)
5. [パフォーマンス監視](#パフォーマンス監視)
6. [プレイヤーサポート](#プレイヤーサポート)
7. [アップデート・メンテナンス](#アップデートメンテナンス)

---

## 日常作業チェックリスト

### 毎日
- [ ] サーバーログの確認
- [ ] エラーログのチェック
- [ ] パフォーマンス統計の確認
- [ ] プレイヤーアクティビティの確認
- [ ] NPC動作確認（ランダムチェック）

### 毎週
- [ ] データベースバックアップ
- [ ] 設定ファイルのバックアップ
- [ ] 経済バランスの確認
- [ ] プレイヤーフィードバックの確認
- [ ] 取引統計の分析

### 毎月
- [ ] 古いログファイルの削除
- [ ] データベースクリーンアップ・最適化
- [ ] 価格設定の見直し
- [ ] 新機能の検討
- [ ] セキュリティアップデート確認

---

## 毎日の作業

### 朝の確認作業（10-15分）

#### 1. サーバーログ確認
```bash
# 最新100行のログを確認
tail -100 logs/latest.log

# エラーのみ抽出
grep ERROR logs/latest.log | tail -50
```

**確認ポイント**:
- クラッシュやエラーの有無
- 異常なアクティビティ
- パフォーマンス警告

#### 2. パフォーマンス統計
```bash
# TPS確認
/tps

# TofuNomicsパフォーマンス統計
/tofunomics performance

# メモリ使用状況
/tofunomics status
```

**健全な指標**:
- TPS: 19.5-20.0
- メモリ使用率: 70%以下
- データベース応答時間: 100ms以下

#### 3. プレイヤーアクティビティ確認
```bash
# オンラインプレイヤー数確認
/list

# 最近のログイン確認
/tofunomics stats players recent

# 経済活動確認
/balancetop
/trade stats 1  # 昨日の取引統計
```

### 夕方の確認作業（5-10分）

#### 1. エラーログ確認
```bash
# 本日のエラーログ確認
grep "$(date +%Y-%m-%d)" plugins/TofuNomics/logs/error.log
```

#### 2. NPC動作確認
```bash
# NPC一覧確認
/tofunomics npc list

# ランダムにNPCへテレポートして動作確認
/tofunomics npc tp <NPC名>
```

#### 3. プレイヤーサポート
- チャットでの質問対応
- 問題報告の確認
- フィードバックの記録

---

## 毎週の作業

### 週次メンテナンス（30-60分）

#### 1. バックアップ実施

##### データベースバックアップ
```bash
# 自動バックアップ確認
ls -lh backups/ | grep $(date +%Y-%m)

# 手動バックアップ（必要に応じて）
cp plugins/TofuNomics/tofunomics_world.db \
   backups/tofunomics_world_$(date +%Y%m%d).db
```

##### 設定ファイルバックアップ
```bash
# config.ymlバックアップ
cp plugins/TofuNomics/config.yml \
   backups/config_$(date +%Y%m%d).yml

# プラグインフォルダ全体バックアップ（月1回）
tar -czf backups/TofuNomics_$(date +%Y%m%d).tar.gz \
   plugins/TofuNomics/
```

#### 2. 経済バランス確認

##### 統計確認
```bash
# 残高ランキング
/balancetop

# 経済統計
/tofunomics economy stats

# 取引統計（過去7日間）
/trade stats 7
```

##### 分析ポイント
```yaml
健全な経済指標:
  平均残高: 1,000-5,000G
  上位10%残高: 10,000-50,000G
  下位10%残高: 100-500G
  週間取引総額: サーバー総資産の20-30%
```

**異常パターン**:
- 急激な残高増加（不正の可能性）
- 極端な格差（調整が必要）
- 取引量の激減（価格や制限の見直し）

#### 3. プレイヤーフィードバック確認

##### フィードバックソース
- ゲーム内チャット
- Discordサーバー
- フォーラム・掲示板
- アンケート

##### 対応優先度
| 優先度 | 内容 | 対応期限 |
|--------|------|----------|
| 高 | バグ・エラー報告 | 24時間以内 |
| 中 | バランス調整要望 | 1週間以内 |
| 低 | 新機能要望 | 1ヶ月以内 |

---

## 毎月の作業

### 月次メンテナンス（1-2時間）

#### 1. ログファイルクリーンアップ

##### 古いログ削除
```bash
# 30日以上前のログを削除
find logs/ -name "*.log.gz" -mtime +30 -delete

# TofuNomicsログの削除
find plugins/TofuNomics/logs/ -name "*.log" -mtime +30 -delete
```

##### ログローテーション設定
```bash
# logrotate設定例（/etc/logrotate.d/tofunomics）
/path/to/server/plugins/TofuNomics/logs/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
}
```

#### 2. データベース最適化

##### 最適化実行
```bash
# サーバー停止
/stop

# SQLiteデータベース最適化
sqlite3 plugins/TofuNomics/tofunomics_world.db "VACUUM;"
sqlite3 plugins/TofuNomics/tofunomics_world.db "ANALYZE;"

# サーバー起動
```

##### データベースサイズ確認
```bash
# 最適化前後のサイズ比較
ls -lh plugins/TofuNomics/tofunomics_world.db
```

#### 3. 価格設定の見直し

##### 価格トレンド分析
```bash
# 取引統計（過去30日間）
/trade stats 30

# 人気アイテムランキング
/tofunomics economy trending 30
```

##### 調整例
```yaml
# config.yml
item_prices:
  # 取引が多いアイテムは価格を微調整
  diamond: 65.0  # 60.0 → 65.0（需要高）

  # 取引が少ないアイテムは価格を下げる
  emerald: 70.0  # 80.0 → 70.0（需要低）
```

#### 4. セキュリティアップデート

##### プラグイン更新確認
```bash
# GitHub / SpigotMC で最新版確認
# リリースノート確認
# テスト環境での検証
```

##### アップデート手順
```bash
# 1. バックアップ
cp -r plugins/TofuNomics backups/TofuNomics_pre_update

# 2. サーバー停止
/stop

# 3. プラグイン更新
cp TofuNomics-new.jar plugins/TofuNomics.jar

# 4. 設定ファイル確認（新設定項目の追加）
# 5. サーバー起動
# 6. 動作確認
```

---

## パフォーマンス監視

### リアルタイム監視

#### 重要指標
```bash
# TPS（Ticks Per Second）
/tps
# 目標: 19.5-20.0

# メモリ使用量
/tofunomics performance
# 目標: 70%以下

# データベース応答時間
/tofunomics database stats
# 目標: 100ms以下

# キャッシュヒット率
/tofunomics cache stats
# 目標: 80%以上
```

### パフォーマンス低下時の対応

#### 即座の対応
```bash
# 1. 現在の負荷確認
/tofunomics performance

# 2. キャッシュクリア
/tofunomics cache clear

# 3. データベース最適化（軽量）
/tofunomics database optimize --quick
```

#### 設定調整
```yaml
# config.yml
performance:
  # キャッシュサイズ増加
  caching:
    player_cache:
      max_size: 1500  # 1000 → 1500

  # バッチ処理サイズ調整
  database:
    batch_processing:
      batch_size: 150  # 100 → 150
```

### アラート設定

#### パフォーマンスアラート
```yaml
# config.yml
performance:
  alerts:
    enabled: true
    tps_threshold: 18.0          # TPS警告閾値
    memory_threshold: 80         # メモリ使用率警告（%）
    alert_admins: true           # 管理者に通知
```

#### 受信権限
```yaml
# 管理者にアラート受信権限を付与
tofunomics.admin.alerts: true
```

---

## プレイヤーサポート

### よくある質問（FAQ）対応

#### 職業関連
**Q: 職業を変更したい**
```
A: /jobs leave で現在の職業を辞めてから
   /jobs join <職業名> で新しい職業に就職してください。
   ただし、レベル50以上の場合のみ転職可能で、
   24時間のクールダウンがあります。
```

**Q: スキルが使えない**
```
A: スキルは特定のレベルに達すると確率で発動します。
   発動確率はレベルが上がると向上します。
   /jobs skills で現在のスキル情報を確認できます。
```

#### 経済関連
**Q: 残高が減っている**
```
A: /trade history <あなたの名前> 7 で過去7日間の
   取引履歴を確認できます。
   不明な取引がある場合は管理者に報告してください。
```

**Q: NPCが反応しない**
```
A: 以下を確認してください：
   1. NPCから5ブロック以内にいるか
   2. 食料NPCの場合、営業時間内か（6:00-22:00）
   3. 右クリックでインタラクトしているか
```

### 問題報告への対応

#### 報告受付フォーマット
```yaml
報告内容:
  プレイヤー名: [名前]
  発生日時: [YYYY-MM-DD HH:MM]
  問題の種類: [バグ/エラー/要望/その他]
  詳細: [詳細な説明]
  再現手順: [手順]
  スクリーンショット: [あれば]
```

#### 対応手順
1. **受付確認**: 報告を受け取ったことを伝える
2. **問題確認**: ログやデータで問題を確認
3. **一時対応**: 可能であれば即座に対処
4. **恒久対応**: 設定変更やアップデートで根本解決
5. **報告者へ連絡**: 対応完了を報告

### プレイヤー案内

#### 新規プレイヤー向け
```
初心者ガイド:
1. /jobs browse で職業一覧を確認
2. /jobs join <職業名> で職業に就く
3. 職業に応じたアイテムを集める
4. NPCで売却して金塊を獲得
5. レベルアップでスキル解放
```

#### 中級プレイヤー向け
```
効率化のコツ:
1. 職業レベル25でボーナス装備獲得
2. スキル発動を狙って効率アップ
3. 取引チェストで大量売却
4. 複数の取引所を活用
```

---

## アップデート・メンテナンス

### 定期メンテナンスの告知

#### 告知タイミング
- **1週間前**: 第1回告知（Discord/掲示板）
- **3日前**: 第2回告知（ゲーム内）
- **1日前**: 最終告知（全チャネル）
- **1時間前**: カウントダウン開始
- **10分前/5分前/1分前**: 最終警告

#### 告知文例
```
【メンテナンス告知】
日時: 2024年1月15日（月） 3:00-5:00
内容:
- データベース最適化
- プラグインアップデート
- パフォーマンス改善

注意事項:
- この時間はサーバーに接続できません
- 作業中のデータは事前に保存してください
- 延長の可能性があります
```

### メンテナンス実施手順

#### 事前準備
```bash
# 1. バックアップ実行
./backup.sh

# 2. プレイヤーに最終警告
/broadcast メンテナンスを開始します。5分後にサーバーを停止します。

# 3. サーバー停止
/stop
```

#### メンテナンス作業
```bash
# 1. データベース最適化
sqlite3 plugins/TofuNomics/tofunomics_world.db "VACUUM;"

# 2. プラグイン更新
cp TofuNomics-new.jar plugins/TofuNomics.jar

# 3. 設定確認
nano plugins/TofuNomics/config.yml

# 4. ログクリーンアップ
find logs/ -name "*.log.gz" -mtime +30 -delete
```

#### 動作確認
```bash
# 1. サーバー起動
./start.sh

# 2. プラグイン確認
/plugins

# 3. 基本機能テスト
/tofunomics status
/tofunomics npc list
/jobs browse

# 4. パフォーマンス確認
/tofunomics performance
```

#### 完了報告
```
【メンテナンス完了】
作業内容:
✅ データベース最適化
✅ プラグインアップデート（v1.2.0）
✅ パフォーマンス改善

変更点:
- 経済システムの高速化
- NPC応答速度の改善
- 新スキルの追加

ご協力ありがとうございました！
```

---

## ベストプラクティス

### 1. ドキュメント管理
- 作業ログを記録
- 設定変更履歴を保持
- プレイヤーフィードバックを蓄積

### 2. コミュニケーション
- 定期的な状況報告
- 透明性のある運営
- プレイヤーとの対話

### 3. 予防保守
- 定期的なバックアップ
- プロアクティブな監視
- 計画的なアップデート

### 4. 継続的改善
- データに基づく調整
- プレイヤーフィードバックの活用
- 新機能の検討

---

## 作業記録テンプレート

### 日次作業ログ
```markdown
## 2024-01-15 日次作業ログ

### 確認事項
- [ ] サーバーログ確認
- [ ] パフォーマンス統計
- [ ] プレイヤーアクティビティ

### 発見事項
- エラーなし
- TPS: 19.8（正常）
- プレイヤー数: ピーク25人

### 対応事項
- なし

### 備考
- 特記事項なし
```

### 週次作業ログ
```markdown
## 2024-W03 週次作業ログ

### 実施事項
- [x] データベースバックアップ
- [x] 経済バランス確認
- [x] プレイヤーフィードバック確認

### 統計情報
- 平均残高: 3,200G
- 週間取引総額: 450,000G
- アクティブプレイヤー: 78人

### 対応事項
- ダイヤモンド価格を60G→65Gに調整

### 次週の予定
- 新NPC設置検討
- 価格調整の効果確認
```

---

## 関連ドキュメント
- **[管理者ガイドTOP](README.md)** - 管理者ガイドトップ
- **[トラブルシューティング](troubleshooting.md)** - 問題対処方法
- **[設定ファイル](configuration.md)** - 設定変更方法
- **[パフォーマンス監視](../performance-tuning.md)** - 詳細な最適化

---

**最終更新**: 2024年
**ドキュメントバージョン**: 1.0
