## **プラグイン『TofuNomics』要件定義書**

| **プロジェクト** | Minecraftサーバー「Tofu」独自経済プラグイン |

### **1\. 概要**

本プラグインは、Minecraftサーバー「Tofu」に独自の経済と職業システムを導入し、プレイヤー主導の経済活動を活性化させることで、サーバー独自の名物コンテンツを創出することを目的とする。

プレイヤーは8つの専門的な職業から1つを選択し、職業に応じた活動を通じて通貨を獲得する。VCRサーバーにインスパイアされた職業レベルシステムを導入し、プレイヤーに長期的な成長目標とやりがいを提供する。

経済モデルは、インフレを抑制しプレイヤー間交易を促進する「NPC買取モデル」を基本とする。

### **2\. 機能要件**

#### **2.1. 経済システム**

* **通貨**: 物理アイテム「金塊 (Gold Nugget)」をプレイヤー間取引の基準通貨とする。論理的な通貨残高はデータベースで管理する（単位: G）。
* **収入**: 収入源は以下の2つを主軸とする。
    * **NPCへの売却**: プレイヤーは職業に応じたアイテムを「交易所NPC」に売却することで、安定した基礎収入（銀行残高）を得る。これは各アイテムの「最低保証価格」としての役割を担う。
    * **プレイヤー間交易**: プレイヤー同士が自由に価格を設定し、アイテムやサービスを売買する。NPCへの売却価格を基準としつつ、需要と供給に応じてより高い価格で取引することが可能であり、これが経済活動の中心かつ、より大きな収入を得るための主要な手段となる。
* **銀行機能**: プレイヤーはコマンドを介して、銀行残高を物理的な金塊として引き出したり (/withdraw)、金塊を銀行に預け入れたり (/deposit) することができる。

#### **2.2. 職業システム**

* **職業数**: 全8職業（鉱夫, 木こり, 農家, 釣り人, 鍛冶屋, ポーション屋, エンチャンター, 建築家）。
* **就職**: プレイヤーはコマンド (/jobs join) を用いて1つの職業に就く。他の職業に就く場合は、一度辞職 (/jobs leave) する必要がある。
* **アイテム制限**: 各職業には、その役割を専門化させるための使用可能アイテム制限が課せられる。
* **建築制限**:
    * **基本ブロック**（土、石、木材など）は、全職業が自由に設置可能。
    * **装飾ブロック**（テラコッタ、コンクリート、色付きガラス、クォーツブロックなど）の設置は**建築家**のみに許可される。

#### **2.3.土地所有システム (ハイブリッドモデル)**

* #### **都市部 (Protected Zone):**

    * #### **スポーン地点周辺などの指定されたエリアでは、建築を行うために土地を購入する必要がある。**

    * #### **購入した土地は、土地保護プラグイン（例: WorldGuard）と連携し、所有者以外によるブロックの設置・破壊ができないように保護される。**

    * #### **土地の購入は、高額な通貨を消費する主要なマネーシンクとして機能する。**

* #### **自然 (Wilderness):**

    * #### **都市部以外の広大なエリアでは、誰でも自由にブロックを設置・破壊できる。**

    * #### **このエリアでの建築物は、土地保護の対象外となる。**

#### **2.4.職業レベルシステム**

* **経験値獲得**: 各職業は、専門的な行動（鉱石の採掘、アイテムのクラフト等）を行うことで、職業経験値（EXP）を獲得する。
* **レベルアップ**: EXPが一定値に達すると職業レベルが上昇し、称号が変化すると共に、新たなスキルやボーナスが解放される。

#### **2.5. 職業詳細とレベルアップ恩恵**

##### **⛏️ 鉱夫 (Miner)**

* **役割**: 鉱物資源と石材の供給。
* **アイテム制限**: ツルハシ, シャベル。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い鉱夫 | 売却ボーナス \+5% |  
  | 10 | 熟練鉱夫 |幸運の兆し  
  低確率で経験値ボトルを追加ドロップ |  
  | 25 | マスターマイナー |連鎖破壊  
  鉱脈を一括破壊 (クールダウンあり) |  
  | 50 | アースワーデン |ダイヤモンドの嗅覚  
  ダイヤモンド鉱石が近くにあるとパーティクルで表示 |  
  | 75 | 伝説の岩窟王 | 売却ボーナス \+20% (合計),連鎖破壊  
  クールダウン短縮 |

##### **🪓 木こり (Woodcutter)**

* **役割**: 木材の供給。
* **アイテム制限**: 斧。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い木こり | 売却ボーナス \+5% |  
  | 10 | 熟練木こり |植林家の知恵  
  苗木の成長速度が上昇 |  
  | 25 | マスターランバージャック |一括伐採  
  原木を一括破壊 (クールダウンあり) |  
  | 50 | フォレストキーパー |森の恵み  
  伐採時、稀に追加アイテムをドロップ |  
  | 75 | 生命の樹の守り手 | 売却ボーナス \+20% (合計),一括伐採  
  クールダウン短縮 |

##### **🌾 農家 (Farmer)**

* **役割**: 農作物・畜産物の供給。
* **アイテム制限**: クワ, ハサミ。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い農家 | 売却ボーナス \+5% |  
  | 10 | 熟練農家 |緑の指  
  骨粉使用時、確率で2段階成長 |  
  | 25 | マスターファーマー |豊穣の収穫  
  収穫時、確率で収穫量が2倍 |  
  | 50 | 大地の恵み |飼育の達人  
  動物繁殖時、確率で双子が生まれる |  
  | 75 | 収穫の神 | 売却ボーナス \+20% (合計),豊穣の収穫  
  発動率上昇 |

##### **🎣 釣り人 (Fisherman)**

* **役割**: 魚と宝の供給。
* **アイテム制限**: 釣竿。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い釣り人 | 売却ボーナス \+5% |  
  | 10 | 熟練釣り人 |釣り餌  
  釣りにかかる時間が短縮 |  
  | 25 | マスターアングラー |トレジャーハント  
  宝が釣れる確率が上昇 |  
  | 50 | 海の友 |イルカの導き  
  水中で稀に移動速度上昇効果 |  
  | 75 | 深淵の支配者 | 売却ボーナス \+20% (合計),トレジャーハント  
  確率がさらに上昇 |

##### **🔨 鍛冶屋 (Blacksmith)**

* **役割**: ツール、武器、防具の生産と修理。
* **アイテム制限**: なし。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い鍛冶屋 | 売却ボーナス \+5% |  
  | 10 | 熟練鍛冶屋 |名匠の修理  
  金床での素材消費量が確率で1になる |  
  | 25 | マスターブラックスミス |エンチャント親和性  
  自作武具が良いエンチャントを引きやすい |  
  | 50 | 魂を宿す者 |伝説の鍛冶  
  クラフト時、稀にエンチャントが一つ付与される |  
  | 75 | 神器の創造主 | 売却ボーナス \+15% (合計), 金床コストがさらに軽減 |

##### **🧪 ポーション屋 (Alchemist)**

* **役割**: ポーションの生産。
* **アイテム制限**: なし。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い錬金術師 | 売却ボーナス \+5% |  
  | 10 | 熟練錬金術師 |高速醸造  
  醸造時間が短縮 |  
  | 25 | マスターアルケミスト |素材節約  
  醸造時、確率で素材を消費しない |  
  | 50 | 賢者の石を探す者 |効果増幅  
  作成したポーションの効果時間が稀に延長 |  
  | 75 | 真理の探求者 | 売却ボーナス \+20% (合計),素材節約  
  発動率上昇 |

##### **✨ エンチャンター (Enchanter)**

* **役割**: エンチャントサービス。
* **アイテム制限**: なし。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い付与術師 | 売却ボーナス \+5% |  
  | 10 | 熟練付与術師 |魔力抽出  
  金砥石での獲得経験値が増加 |  
  | 25 | マスターエンチャンター |複数付与の才  
  エンチャントテーブルで確率で2つのエンチャントが付く |  
  | 50 | 古代の呪文詠唱者 |禁断の呪文  
  稀にエンチャントテーブルで修繕などが出現 |  
  | 75 | 大賢者 | 売却ボーナス \+20% (合計), エンチャントコストがさらに軽減 |

##### **🏛️ 建築家 (Architect)**

* **役割**: 建築と装飾。
* **アイテム制限**: なし（ただし装飾ブロックの設置は建築家のみ）。
* レベルアップ:  
  | Lv | 称号 | 解放スキル / ボーナス |  
  |:---:|:---|:---|  
  | 1 | 見習い建築家 | 売却ボーナス \+5% |  
  | 10 | 熟練建築家 |建材卸売  
  村人交易で建材の品揃えが良くなることがある |  
  | 25 | マスターアーキテクト |高速設置  
  装飾ブロックの連続設置速度が上昇 |  
  | 50 | 街の設計者 |芸術家の魂  
  建築家専用の特別な装飾ブロックのレシピを習得 |  
  | 75 | 世界の創造主 | 売却ボーナス \+15% (合計), 村人交易リベート率が上昇 |

#### **2.5. コマンド一覧**

| コマンド | エイリアス | 説明 |  |  |
| :---- | :---- | :---- | :---- | :---- |
| /balance \[player\] | /bal | 銀行残高を確認する。 |  |  |
| /pay \<player\> \<amount\> |  | 他プレイヤーに送金する。 |  |  |
| /balancetop | /baltop | 残高ランキングを表示する。 |  |  |
| /withdraw \<amount\> |  | 銀行から金塊を引き出す。 |  |  |
| /deposit \<amount/all\> |  | 金塊を銀行に預ける。 |  |  |
| /jobs join \<jobname\> |  | 指定した職業に就職する。 |  |  |
| /jobs leave |  | 現在の職業を辞職する。 |  |  |
| /jobs stats |  | 職業レベルやスキルを確認する。 |  |  |
| /eco \<give/take/set\>... |  |  | 管理者用 | プレイヤーの残高を操作する。 |
| /eco reload |  |  | 管理者用 | 設定ファイルを再読み込みする。 |

### **3\. 非機能要件**

* **データ管理**: プレイヤーデータはサーバー内の**SQLite**ファイルに保存する。プレイヤーの識別には**UUID**を使用する。パフォーマンス向上のため、ログイン中のプレイヤーデータは**キャッシュ**する戦略を取る。
* **パフォーマンス**: 多数のプレイヤーが同時に活動しても、サーバーのTPSに影響を与えないよう、データベースアクセスなどの重い処理は非同期で行うことを検討する。
* **設定可能性**: 職業ごとの収入額、経験値量、レベルアップに必要な経験値計算式、スキルの発動確率、コマンドのメッセージなど、運営者がバランス調整できるよう\*\*config.yml\*\*で詳細に設定可能とする。
* **信頼性**: サーバーのクラッシュ時にもプレイヤーのデータが失われないよう、安全なデータ保存処理を行う。
* **外部連携**: 土地保護機能を実現するため、**WorldGuard**などの外部プラグインとの連携を前提として設計する。

